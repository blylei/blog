{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"Blylei\u7684\u535a\u5ba2 MkDocs is a fast , simple and downright gorgeous static site generator that's geared towards building project documentation. Documentation source files are written in Markdown, and configured with a single YAML configuration file. Start by reading the [introductory tutorial], then check the [User Guide] for more information. \u535a\u5ba2\u5206\u7c7b MySQL\u76f8\u5173 There's a stack of good looking themes available for MkDocs. Choose between the built in themes: mkdocs and readthedocs , select one of the third-party themes listed on the MkDocs Themes wiki page, or build your own . Redis\u76f8\u5173 Get your project documentation looking just the way you want it by customizing your theme and/or installing some plugins . Modify Markdown's behavior with Markdown extensions . Many configuration options are available. MongoDB\u76f8\u5173 The built-in dev-server allows you to preview your documentation as you're writing it. It will even auto-reload and refresh your browser whenever you save your changes. \u5df2\u5f52\u6863 MkDocs builds completely static HTML sites that you can host on GitHub pages, Amazon S3, or anywhere else you choose.","title":"Blylei\u7684\u535a\u5ba2"},{"location":"index.html#blylei","text":"MkDocs is a fast , simple and downright gorgeous static site generator that's geared towards building project documentation. Documentation source files are written in Markdown, and configured with a single YAML configuration file. Start by reading the [introductory tutorial], then check the [User Guide] for more information.","title":"Blylei\u7684\u535a\u5ba2"},{"location":"about.html","text":"\u5173\u4e8e\u6211 MySQL DBA Frabit \u7cfb\u5217\u9879\u76ee\u7ef4\u62a4\u8005 \u90ae\u7bb1\uff1ablylei@163.com blylei.info@gmail.com","title":"\u5f52\u6863"},{"location":"about.html#_1","text":"MySQL DBA Frabit \u7cfb\u5217\u9879\u76ee\u7ef4\u62a4\u8005 \u90ae\u7bb1\uff1ablylei@163.com blylei.info@gmail.com","title":"\u5173\u4e8e\u6211"},{"location":"mongodb/index.html","text":"","title":"Index"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html","text":"MongoDB\u526f\u672c\u96c6\u5e94\u6025\u5207\u6362 1\u3001\u90e8\u7f72\u60c5\u51b5\u7b80\u4ecb \u90e8\u7f72\u673a\u623f:A\u673a\u623f\u3010\u4e3b\u3011 + B\u673a\u623f\u3010\u5907\u3011 \u526f\u672c\u96c6\u6210\u5458\uff1a 192.168.100.112\u3010\u4e3b\u3011: mongodb01.frabitech.local 192.168.100.113\u3010\u5907\u3011: mongodb02.frabitech.local 192.168.100.114\u3010\u5bb9\u707e\u3011: mongodb03.frabitech.local 2\u3001\u5e94\u6025\u5207\u6362\u6b65\u9aa4 \u5728A\u673a\u623f\u673a\u623f\u51fa\u6545\u969c\u65f6\uff0c\u653e\u7f6e\u5728B\u673a\u623f\u7684\u8282\u70b9\u5c06\u53d8\u6210\u53ea\u8bfb\uff0c\u540c\u65f6\u65e0\u6cd5\u9009\u51fa\u4e3b\u8282\u70b9\u3002\u6b64\u65f6\u4e3a\u4e86\u8ba9\u4e1a\u52a1\u5feb\u901f\u6062\u590d\uff0c\u9700\u8981\u4eba\u5de5\u4ecb\u5165\u3002\u4fee\u6539\u96c6\u7fa4\u914d\u7f6e\uff0c\u5f3a\u5236\u5c06\u5b58\u6d3b\u8282\u70b9\u63d0\u5347\u4e3a\u4e3b\uff0c\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b\u3010\u4ee5\u4e0b\u64cd\u4f5c\u5747\u5728\u5b58\u6d3b\u7684\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\u3011: 2.0 \u5148\u5907\u4efd\u5b58\u6d3b\u7684\u8282\u70b9\u3010\u53ef\u9009\u3011 mongodump 2.1 \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\u4fdd\u7559\u5f53\u524d\u914d\u7f6e cfg=rs.conf() status=rs.statsu() 2.2 \u4ece\u590d\u5236\u96c6\u7fa4\u4e2d\u79fb\u9664\u51fa\u6545\u969c\u7684\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u662f\u5b58\u6d3b\u7684\u8282\u70b9 cfg.members = [cfg.members[0] , cfg.members[1] ,..., cfg.members[n]] 2.3 \u4f7f\u7528force\u9009\u9879\uff0c\u91cd\u65b0\u914d\u7f6e\u526f\u672c\u96c6\uff0c\u6b64\u547d\u4ee4\u4f1a\u89e6\u53d1\u65b0\u7684\u9009\u4e3e rs.reconfig(cfg, {force : true}) 2.4 \u91cd\u65b0\u767b\u9646mongo\uff0c\u67e5\u770b\u5f53\u524d\u8282\u70b9\u7684\u89d2\u8272\u662f\u5426\u63d0\u5347\u4e3a\u4e3b mongo --host 127.0.0.1:27030 -u root -p 'Test_123' --authenticationDatabase admin ReplSetOnline:PRIMARY> db.isMaster() { \"hosts\" : [ \"192.168.100.112:27030\", \"192.168.100.113:27030\", \"192.168.100.114:27030\" ], \"setName\" : \"ReplSetOnline\", \"setVersion\" : 9, \"ismaster\" : true, \"secondary\" : false, \"primary\" : \"192.168.100.112:27030\", \"me\" : \"192.168.100.112:27030\", \"electionId\" : ObjectId(\"7fffffff0000000000000012\"), \"lastWrite\" : { \"opTime\" : { \"ts\" : Timestamp(1619181654, 12), \"t\" : NumberLong(18) }, \"lastWriteDate\" : ISODate(\"2021-04-23T12:40:54Z\") }, \"maxBsonObjectSize\" : 16777216, \"maxMessageSizeBytes\" : 48000000, \"maxWriteBatchSize\" : 1000, \"localTime\" : ISODate(\"2021-04-23T12:40:54.689Z\"), \"maxWireVersion\" : 5, \"minWireVersion\" : 0, \"readOnly\" : false, \"ok\" : 1 }","title":"MongoDB\u526f\u672c\u96c6\u5e94\u6025\u5207\u6362"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#mongodb","text":"","title":"MongoDB\u526f\u672c\u96c6\u5e94\u6025\u5207\u6362"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#1","text":"\u90e8\u7f72\u673a\u623f:A\u673a\u623f\u3010\u4e3b\u3011 + B\u673a\u623f\u3010\u5907\u3011 \u526f\u672c\u96c6\u6210\u5458\uff1a 192.168.100.112\u3010\u4e3b\u3011: mongodb01.frabitech.local 192.168.100.113\u3010\u5907\u3011: mongodb02.frabitech.local 192.168.100.114\u3010\u5bb9\u707e\u3011: mongodb03.frabitech.local","title":"1\u3001\u90e8\u7f72\u60c5\u51b5\u7b80\u4ecb"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#2","text":"\u5728A\u673a\u623f\u673a\u623f\u51fa\u6545\u969c\u65f6\uff0c\u653e\u7f6e\u5728B\u673a\u623f\u7684\u8282\u70b9\u5c06\u53d8\u6210\u53ea\u8bfb\uff0c\u540c\u65f6\u65e0\u6cd5\u9009\u51fa\u4e3b\u8282\u70b9\u3002\u6b64\u65f6\u4e3a\u4e86\u8ba9\u4e1a\u52a1\u5feb\u901f\u6062\u590d\uff0c\u9700\u8981\u4eba\u5de5\u4ecb\u5165\u3002\u4fee\u6539\u96c6\u7fa4\u914d\u7f6e\uff0c\u5f3a\u5236\u5c06\u5b58\u6d3b\u8282\u70b9\u63d0\u5347\u4e3a\u4e3b\uff0c\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b\u3010\u4ee5\u4e0b\u64cd\u4f5c\u5747\u5728\u5b58\u6d3b\u7684\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\u3011:","title":"2\u3001\u5e94\u6025\u5207\u6362\u6b65\u9aa4"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#20","text":"mongodump","title":"2.0 \u5148\u5907\u4efd\u5b58\u6d3b\u7684\u8282\u70b9\u3010\u53ef\u9009\u3011"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#21","text":"cfg=rs.conf() status=rs.statsu()","title":"2.1 \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\u4fdd\u7559\u5f53\u524d\u914d\u7f6e"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#22","text":"cfg.members = [cfg.members[0] , cfg.members[1] ,..., cfg.members[n]]","title":"2.2 \u4ece\u590d\u5236\u96c6\u7fa4\u4e2d\u79fb\u9664\u51fa\u6545\u969c\u7684\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u662f\u5b58\u6d3b\u7684\u8282\u70b9"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#23-force","text":"rs.reconfig(cfg, {force : true})","title":"2.3 \u4f7f\u7528force\u9009\u9879\uff0c\u91cd\u65b0\u914d\u7f6e\u526f\u672c\u96c6\uff0c\u6b64\u547d\u4ee4\u4f1a\u89e6\u53d1\u65b0\u7684\u9009\u4e3e"},{"location":"mongodb/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#24-mongo","text":"mongo --host 127.0.0.1:27030 -u root -p 'Test_123' --authenticationDatabase admin ReplSetOnline:PRIMARY> db.isMaster() { \"hosts\" : [ \"192.168.100.112:27030\", \"192.168.100.113:27030\", \"192.168.100.114:27030\" ], \"setName\" : \"ReplSetOnline\", \"setVersion\" : 9, \"ismaster\" : true, \"secondary\" : false, \"primary\" : \"192.168.100.112:27030\", \"me\" : \"192.168.100.112:27030\", \"electionId\" : ObjectId(\"7fffffff0000000000000012\"), \"lastWrite\" : { \"opTime\" : { \"ts\" : Timestamp(1619181654, 12), \"t\" : NumberLong(18) }, \"lastWriteDate\" : ISODate(\"2021-04-23T12:40:54Z\") }, \"maxBsonObjectSize\" : 16777216, \"maxMessageSizeBytes\" : 48000000, \"maxWriteBatchSize\" : 1000, \"localTime\" : ISODate(\"2021-04-23T12:40:54.689Z\"), \"maxWireVersion\" : 5, \"minWireVersion\" : 0, \"readOnly\" : false, \"ok\" : 1 }","title":"2.4 \u91cd\u65b0\u767b\u9646mongo\uff0c\u67e5\u770b\u5f53\u524d\u8282\u70b9\u7684\u89d2\u8272\u662f\u5426\u63d0\u5347\u4e3a\u4e3b"},{"location":"mysql/index.html","text":"MySQL\u76f8\u5173 202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/index.html#mysql","text":"202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/202112/index.html","text":"MySQL\u76f8\u5173 202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/202112/index.html#mysql","text":"202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html","text":"MHA\u642d\u5efa\u6b65\u9aa4 1\u3001MySQL\u4e3b\u4ece\u642d\u5efa 1.1 MySQL\u90e8\u7f72\u548c\u4e3b\u4ece\u642d\u5efa(\u7565) 1.2 MHA\u7ba1\u7406\u8d26\u53f7\u521b\u5efa CREATE USER 'mha'@'172.16.3.%' IDENTIFIED BY 'passwd'\uff1b # \u5bc6\u7801\u53ef\u4ee5\u4ece\u5df2\u6709MHA\u914d\u7f6e\u6587\u4ef6\u5185\u67e5\u770b GRANT ALL PRIVILEGES ON *.* TO 'mha'@'172.16.3.%'\uff1b 2\u3001MHA\u7ec4\u4ef6\u5b89\u88c5 2.1 \u5b89\u88c5\u5305\u4e0b\u8f7d \u53ef\u4ee5\u8bbf\u95ee MHA\u7684github\u4e3b\u9875 \u4e0b\u8f7d\u6e90\u7801\u81ea\u884c\u7f16\u8bd1\u5b89\u88c5\uff0c\u6b64\u5904\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684rpm\u5305,\u9700\u8981\u6ce8\u610f\u5b89\u88c5\u5305\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5339\u914d # \u4e0b\u8f7d MHA Manager\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm # \u4e0b\u8f7d MHA Node\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm 2.2 MHA\u7ec4\u4ef6\u5b89\u88c5 MHA\u7531 MHA-node\u548cMHA-manger\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMHA-node\u9700\u8981\u90e8\u7f72\u5728\u53c2\u4e0e\u6784\u5efaMHA\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0cMHA-manger\u53ea\u9700\u8981\u5728\u7ba1\u7406\u5b9e\u4f8b\u4e0a\u90e8\u7f72\u5373\u53ef # \u5728\u9700\u8981\u53c2\u4e0eMHA\u90e8\u7f72\u7684MySQL\u5b9e\u4f8b\u4e0a\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u5305\u548cMHA Node yum install perl-DBD-MySQL yum install perl-devel rpm -ivh mha4mysql-node-X.Y-0.noarch. # \u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5\u6240\u9700\u4f9d\u8d56\u548cMHA Manager\uff0cMHA Node \u53ea\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u662f\u591a\u5957MHA\u5171\u7528\u7684 yum install perl-DBD-MySQL yum install perl-devel yum install perl-Config-Tiny yum install perl-Log-Dispatch yum install perl-Parallel-ForkManager rpm -ivh mha4mysql-node-X.Y-0.noarch.rpm rpm -ivh mha4mysql-manager-X.Y-0.noarch.rpm 2.3 MHA\u914d\u7f6e \u5b89\u88c5\u5b8cMHA\u7684\u5404\u4e2a\u7ec4\u4ef6\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e: 2.3.1 \u4fee\u6539\u7f51\u5361\u540d # \u4fee\u6539\u89c4\u5219\u6587\u4ef6 cd /etc/udev/rules.d touch 70-persistent-ipoib.rules less 70-persistent-ipoib.rules # This is a sample udev rules file that demonstrates how to get udev to # set the name of IPoIB interfaces to whatever you wish. There is a # 16 character limit on network device names though, so don't go too nuts # # Important items to note: ATTR{type}==\"32\" is IPoIB interfaces, and the # ATTR{address} match must start with ?* and only reference the last 8 # bytes of the address or else the address might not match on any given # start of the IPoIB stack # # Note: as of rhel7, udev is case sensitive on the address field match # and all addresses need to be in lower case. # # ACTION==\"add\", SUBSYSTEM==\"net\", DRIVERS==\"?*\", ATTR{type}==\"32\", ATTR{address}==\"?*00:02:c9:03:00:31:78:f2\", NAME=\"mlx4_ib3\" SUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{type}==\"1\", ATTR{address}==\"00:50:56:af:23:b8\",KERNEL==\"ens*\", NAME=\"bond0\" # \u4fee\u6539ATTR \u4e3a\u76ee\u6807\u7f51\u5361\u7684mac\u5730\u5740\uff0cKERNEL\u4e3a\u5f53\u524d\u7f51\u5361\u540d \uff0cNAME\u4e3a\u9700\u8981\u91cd\u547d\u540d\u7684\u7f51\u5361\u540d\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ea\u9700\u8981\u4fee\u6539ATTR\u7684\u503c\u5c31\u884c # \u4fee\u6539\u7f51\u5361\u914d\u7f6e\u6587\u4ef6 cd /etc/sysconfig/network-scripts cp ifcfg-ens160 ifcfg-bond0 vim ifcfg-bond0 HWADDR=00:50:56:af:23:b8 NAME=bond0 # \u4eceens160 \u6539\u4e3abond0 PEERDNS=no NM_CONTROLLED=no GATEWAY=172.16.31.200 DEVICE=bond0 # \u4eceens160 \u6539\u4e3abond0 ONBOOT=yes USERCTL=no BOOTPROTO=static NETMASK=255.255.255.0 IPADDR=172.16.31.103 IPV6INIT=yes IPV6_AUTOCONF=yes # \u91cd\u542f\u673a\u5668 reboot 2.3.2 \u5de5\u4f5c\u6587\u4ef6\u5939\u521b\u5efa export mha_app=db6_4_30 #\u547d\u540d\u683c\u5f0f:\u6570\u636e\u5e93\u5b9e\u4f8b\u540d_vip\u7b2c3\u6bb5_vip\u7b2c4\u6bb5 mkdir -p /data/mha_workdir/${mha_app} # \u6839\u636eMHA\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u521b\u5efa\u5bf9\u5e94\u7684\u5e94\u7528\u8def\u5f84\uff0c\u7528\u6765\u4fdd\u5b58\u5bf9\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u3001\u914d\u7f6e\u6587\u4ef6\u3001\u5fc3\u8df3\u68c0\u6d4b\u6587\u4ef6\u7b49 2.3.3 MHA\u8282\u70b9\u95f4\u514d\u5bc6\u767b\u5f55 # \u4f9d\u6b21\u5728\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip # \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66\uff08\u53ef\u9009\uff0c\u591a\u5957MHA\u5171\u7528\u7ba1\u7406\u8282\u70b9\u7684\u8bdd\uff0c\u8bc1\u4e66\u5df2\u5b58\u5728\uff09 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u4ece\u7ba1\u7406\u8282\u70b9\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip 2.3.4 MHA\u914d\u7f6e\u6587\u4ef6\u521b\u5efa touch /data/mha_workdir/${mha_app}/${mha_app}.cnf 2.3.5 MHA\u76f8\u5173\u811a\u672c\u5b9a\u4e49 \u9700\u8981\u5728\u4e0b\u5217\u811a\u672c\u4e2d\u65b0\u589evip\u548c\u7f51\u5361\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u811a\u672c\u4e2d\uff0c\u4fee\u6539\u65f6\u4e00\u6837\u7684 # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u5b9e\u73b0\u5728\u7ebf\u5207\u6362master\u8282\u70b9 master_ip_online_change # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u6458\u9664vip master_ip_failover 3\u3001MHA\u8fd0\u884c\u72b6\u6001\u786e\u8ba4 \u5728\u4e4b\u524d\u7684\u6240\u6709\u6b65\u9aa4\u51c6\u786e\u65e0\u8bef\u7684\u5b8c\u6210\u540e\uff0c\u53ef\u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u5bf9MHA\u8fdb\u884c\u4e0b\u5217\u68c0\u67e5 3.1 \u514d\u5bc6\u767b\u5f55\u68c0\u67e5 masterha_check_ssh --conf=/data/mha_workdir/${mha_app}/${mha_app}.cnf 3.2 \u4e3b\u4ece\u590d\u5236\u68c0\u67e5 masterha_check_repl --conf=/data/mha_workdir/${mha_app}/${mha_app}.cnf 4\u3001\u542f\u52a8MHA \u5728\u7b2c3\u6b65\u9aa4\u4e2d\u4e24\u9879\u68c0\u67e5\u90fd\u901a\u8fc7\u4ee5\u540e\uff0c\u53ef\u4ee5\u542f\u52a8MHA\uff0c\u63a8\u8350\u4f7f\u7528screen\u521b\u5efa\u4f1a\u8bdd\uff0c\u7136\u540e\u5728\u91cc\u9762\u8fdb\u884c\u542f\u52a8 # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\u521b\u5efa\u5e76\u8fdb\u5165\u8be5\u4f1a\u8bdd\u7a97\u53e3 screen -S ${mha_app} # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\u542f\u52a8MHA\uff0c\u7136\u540e\u76f4\u63a5\u5173\u95ed\u4f1a\u8bdd\u7a97\u53e3 masterha_manager --conf=/data/mha_workdir/${mha_app}/${mha_app}.cnf --ignore_fail_on_start --ignore_last_failover >>/data/mha_workdir/${mha_app}/${mha_app}.log 2>&1 & # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u68c0\u67e5MHA\u8fd0\u884c\u72b6\u6001,\u8f93\u51fa:${mha_app}is running\u8bf4\u660eMHA\u5df2\u6b63\u5e38\u542f\u52a8 masterha_check_status --conf=/data/mha_workdir/${mha_app}/${mha_app}.cnf 5\u3001MHA\u76f8\u5173\u76d1\u63a7\u6dfb\u52a0 5.1 \u4e3b\u673a\u4f4d\u7f6e\u76d1\u63a7 5.2 mha\u8fdb\u7a0b\u76d1\u63a7","title":"MHA\u642d\u5efa\u6b65\u9aa4"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#mha","text":"","title":"MHA\u642d\u5efa\u6b65\u9aa4"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#1mysql","text":"","title":"1\u3001MySQL\u4e3b\u4ece\u642d\u5efa"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#11-mysql","text":"","title":"1.1 MySQL\u90e8\u7f72\u548c\u4e3b\u4ece\u642d\u5efa(\u7565)"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#12-mha","text":"CREATE USER 'mha'@'172.16.3.%' IDENTIFIED BY 'passwd'\uff1b # \u5bc6\u7801\u53ef\u4ee5\u4ece\u5df2\u6709MHA\u914d\u7f6e\u6587\u4ef6\u5185\u67e5\u770b GRANT ALL PRIVILEGES ON *.* TO 'mha'@'172.16.3.%'\uff1b","title":"1.2 MHA\u7ba1\u7406\u8d26\u53f7\u521b\u5efa"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#2mha","text":"","title":"2\u3001MHA\u7ec4\u4ef6\u5b89\u88c5"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#21","text":"\u53ef\u4ee5\u8bbf\u95ee MHA\u7684github\u4e3b\u9875 \u4e0b\u8f7d\u6e90\u7801\u81ea\u884c\u7f16\u8bd1\u5b89\u88c5\uff0c\u6b64\u5904\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684rpm\u5305,\u9700\u8981\u6ce8\u610f\u5b89\u88c5\u5305\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5339\u914d # \u4e0b\u8f7d MHA Manager\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm # \u4e0b\u8f7d MHA Node\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm","title":"2.1 \u5b89\u88c5\u5305\u4e0b\u8f7d"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#22-mha","text":"MHA\u7531 MHA-node\u548cMHA-manger\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMHA-node\u9700\u8981\u90e8\u7f72\u5728\u53c2\u4e0e\u6784\u5efaMHA\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0cMHA-manger\u53ea\u9700\u8981\u5728\u7ba1\u7406\u5b9e\u4f8b\u4e0a\u90e8\u7f72\u5373\u53ef # \u5728\u9700\u8981\u53c2\u4e0eMHA\u90e8\u7f72\u7684MySQL\u5b9e\u4f8b\u4e0a\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u5305\u548cMHA Node yum install perl-DBD-MySQL yum install perl-devel rpm -ivh mha4mysql-node-X.Y-0.noarch. # \u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5\u6240\u9700\u4f9d\u8d56\u548cMHA Manager\uff0cMHA Node \u53ea\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u662f\u591a\u5957MHA\u5171\u7528\u7684 yum install perl-DBD-MySQL yum install perl-devel yum install perl-Config-Tiny yum install perl-Log-Dispatch yum install perl-Parallel-ForkManager rpm -ivh mha4mysql-node-X.Y-0.noarch.rpm rpm -ivh mha4mysql-manager-X.Y-0.noarch.rpm","title":"2.2 MHA\u7ec4\u4ef6\u5b89\u88c5"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#23-mha","text":"\u5b89\u88c5\u5b8cMHA\u7684\u5404\u4e2a\u7ec4\u4ef6\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e:","title":"2.3 MHA\u914d\u7f6e"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#231","text":"# \u4fee\u6539\u89c4\u5219\u6587\u4ef6 cd /etc/udev/rules.d touch 70-persistent-ipoib.rules less 70-persistent-ipoib.rules # This is a sample udev rules file that demonstrates how to get udev to # set the name of IPoIB interfaces to whatever you wish. There is a # 16 character limit on network device names though, so don't go too nuts # # Important items to note: ATTR{type}==\"32\" is IPoIB interfaces, and the # ATTR{address} match must start with ?* and only reference the last 8 # bytes of the address or else the address might not match on any given # start of the IPoIB stack # # Note: as of rhel7, udev is case sensitive on the address field match # and all addresses need to be in lower case. # # ACTION==\"add\", SUBSYSTEM==\"net\", DRIVERS==\"?*\", ATTR{type}==\"32\", ATTR{address}==\"?*00:02:c9:03:00:31:78:f2\", NAME=\"mlx4_ib3\" SUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{type}==\"1\", ATTR{address}==\"00:50:56:af:23:b8\",KERNEL==\"ens*\", NAME=\"bond0\" # \u4fee\u6539ATTR \u4e3a\u76ee\u6807\u7f51\u5361\u7684mac\u5730\u5740\uff0cKERNEL\u4e3a\u5f53\u524d\u7f51\u5361\u540d \uff0cNAME\u4e3a\u9700\u8981\u91cd\u547d\u540d\u7684\u7f51\u5361\u540d\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ea\u9700\u8981\u4fee\u6539ATTR\u7684\u503c\u5c31\u884c # \u4fee\u6539\u7f51\u5361\u914d\u7f6e\u6587\u4ef6 cd /etc/sysconfig/network-scripts cp ifcfg-ens160 ifcfg-bond0 vim ifcfg-bond0 HWADDR=00:50:56:af:23:b8 NAME=bond0 # \u4eceens160 \u6539\u4e3abond0 PEERDNS=no NM_CONTROLLED=no GATEWAY=172.16.31.200 DEVICE=bond0 # \u4eceens160 \u6539\u4e3abond0 ONBOOT=yes USERCTL=no BOOTPROTO=static NETMASK=255.255.255.0 IPADDR=172.16.31.103 IPV6INIT=yes IPV6_AUTOCONF=yes # \u91cd\u542f\u673a\u5668 reboot","title":"2.3.1 \u4fee\u6539\u7f51\u5361\u540d"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#232","text":"export mha_app=db6_4_30 #\u547d\u540d\u683c\u5f0f:\u6570\u636e\u5e93\u5b9e\u4f8b\u540d_vip\u7b2c3\u6bb5_vip\u7b2c4\u6bb5 mkdir -p /data/mha_workdir/${mha_app} # \u6839\u636eMHA\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u521b\u5efa\u5bf9\u5e94\u7684\u5e94\u7528\u8def\u5f84\uff0c\u7528\u6765\u4fdd\u5b58\u5bf9\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u3001\u914d\u7f6e\u6587\u4ef6\u3001\u5fc3\u8df3\u68c0\u6d4b\u6587\u4ef6\u7b49","title":"2.3.2 \u5de5\u4f5c\u6587\u4ef6\u5939\u521b\u5efa"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#233-mha","text":"# \u4f9d\u6b21\u5728\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip # \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66\uff08\u53ef\u9009\uff0c\u591a\u5957MHA\u5171\u7528\u7ba1\u7406\u8282\u70b9\u7684\u8bdd\uff0c\u8bc1\u4e66\u5df2\u5b58\u5728\uff09 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u4ece\u7ba1\u7406\u8282\u70b9\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip","title":"2.3.3 MHA\u8282\u70b9\u95f4\u514d\u5bc6\u767b\u5f55"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#234-mha","text":"touch /data/mha_workdir/${mha_app}/${mha_app}.cnf","title":"2.3.4 MHA\u914d\u7f6e\u6587\u4ef6\u521b\u5efa"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#235-mha","text":"\u9700\u8981\u5728\u4e0b\u5217\u811a\u672c\u4e2d\u65b0\u589evip\u548c\u7f51\u5361\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u811a\u672c\u4e2d\uff0c\u4fee\u6539\u65f6\u4e00\u6837\u7684 # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u5b9e\u73b0\u5728\u7ebf\u5207\u6362master\u8282\u70b9 master_ip_online_change # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u6458\u9664vip master_ip_failover","title":"2.3.5 MHA\u76f8\u5173\u811a\u672c\u5b9a\u4e49"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#3mha","text":"\u5728\u4e4b\u524d\u7684\u6240\u6709\u6b65\u9aa4\u51c6\u786e\u65e0\u8bef\u7684\u5b8c\u6210\u540e\uff0c\u53ef\u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u5bf9MHA\u8fdb\u884c\u4e0b\u5217\u68c0\u67e5","title":"3\u3001MHA\u8fd0\u884c\u72b6\u6001\u786e\u8ba4"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#31","text":"masterha_check_ssh --conf=/data/mha_workdir/${mha_app}/${mha_app}.cnf","title":"3.1 \u514d\u5bc6\u767b\u5f55\u68c0\u67e5"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#32","text":"masterha_check_repl --conf=/data/mha_workdir/${mha_app}/${mha_app}.cnf","title":"3.2 \u4e3b\u4ece\u590d\u5236\u68c0\u67e5"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#4mha","text":"\u5728\u7b2c3\u6b65\u9aa4\u4e2d\u4e24\u9879\u68c0\u67e5\u90fd\u901a\u8fc7\u4ee5\u540e\uff0c\u53ef\u4ee5\u542f\u52a8MHA\uff0c\u63a8\u8350\u4f7f\u7528screen\u521b\u5efa\u4f1a\u8bdd\uff0c\u7136\u540e\u5728\u91cc\u9762\u8fdb\u884c\u542f\u52a8 # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\u521b\u5efa\u5e76\u8fdb\u5165\u8be5\u4f1a\u8bdd\u7a97\u53e3 screen -S ${mha_app} # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\u542f\u52a8MHA\uff0c\u7136\u540e\u76f4\u63a5\u5173\u95ed\u4f1a\u8bdd\u7a97\u53e3 masterha_manager --conf=/data/mha_workdir/${mha_app}/${mha_app}.cnf --ignore_fail_on_start --ignore_last_failover >>/data/mha_workdir/${mha_app}/${mha_app}.log 2>&1 & # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u68c0\u67e5MHA\u8fd0\u884c\u72b6\u6001,\u8f93\u51fa:${mha_app}is running\u8bf4\u660eMHA\u5df2\u6b63\u5e38\u542f\u52a8 masterha_check_status --conf=/data/mha_workdir/${mha_app}/${mha_app}.cnf","title":"4\u3001\u542f\u52a8MHA"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#5mha","text":"","title":"5\u3001MHA\u76f8\u5173\u76d1\u63a7\u6dfb\u52a0"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#51","text":"","title":"5.1 \u4e3b\u673a\u4f4d\u7f6e\u76d1\u63a7"},{"location":"mysql/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#52-mha","text":"","title":"5.2 mha\u8fdb\u7a0b\u76d1\u63a7"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html","text":"\u57fa\u4e8eGTID\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165 1\u3001gtid\u6982\u5ff5 \u5728MySQL\u5b98\u65b9\u5b9a\u4e49\u4e2d\uff0cGTID\u662f G lobal T ransaction ID entifier (GTID)\u7684\u7f29\u5199\uff0c 2\u3001GTID\u5f02\u5e38\u573a\u666f\u6a21\u62df 2.1 GTID\u6b63\u5e38\u65f6 \u53ef\u4ee5\u8bbf\u95ee MHA\u7684github\u4e3b\u9875 \u4e0b\u8f7d\u6e90\u7801\u81ea\u884c\u7f16\u8bd1\u5b89\u88c5\uff0c\u6b64\u5904\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684rpm\u5305,\u9700\u8981\u6ce8\u610f\u5b89\u88c5\u5305\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5339\u914d # \u4e0b\u8f7d MHA Manager\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm # \u4e0b\u8f7d MHA Node\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm 2.2 GTID\u6b63\u5e38\u65f6 MHA\u7531 MHA-node\u548cMHA-manger\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMHA-node\u9700\u8981\u90e8\u7f72\u5728\u53c2\u4e0e\u6784\u5efaMHA\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0cMHA-manger\u53ea\u9700\u8981\u5728\u7ba1\u7406\u5b9e\u4f8b\u4e0a\u90e8\u7f72\u5373\u53ef # \u5728\u9700\u8981\u53c2\u4e0eMHA\u90e8\u7f72\u7684MySQL\u5b9e\u4f8b\u4e0a\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u5305\u548cMHA Node yum install perl-DBD-MySQL yum install perl-devel rpm -ivh mha4mysql-node-X.Y-0.noarch. # \u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5\u6240\u9700\u4f9d\u8d56\u548cMHA Manager\uff0cMHA Node \u53ea\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u662f\u591a\u5957MHA\u5171\u7528\u7684 yum install perl-DBD-MySQL yum install perl-devel yum install perl-Config-Tiny yum install perl-Log-Dispatch yum install perl-Parallel-ForkManager rpm -ivh mha4mysql-node-X.Y-0.noarch.rpm rpm -ivh mha4mysql-manager-X.Y-0.noarch.rpm 2.3 \u4fee\u590dgtid\u5f02\u5e38\u95ee\u9898 \u5b89\u88c5\u5b8cMHA\u7684\u5404\u4e2a\u7ec4\u4ef6\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e: 2.3.3 \u68c0\u67e5\u4e3b\u3001\u4ece\u5b9e\u4f8bgitd\u503c # \u4f9d\u6b21\u5728\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip # \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66\uff08\u53ef\u9009\uff0c\u591a\u5957MHA\u5171\u7528\u7ba1\u7406\u8282\u70b9\u7684\u8bdd\uff0c\u8bc1\u4e66\u5df2\u5b58\u5728\uff09 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u4ece\u7ba1\u7406\u8282\u70b9\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip 2.3.4 \u62bd\u53d6\u51fa\u591a\u4f59\u7684gtid touch /data/mha_workdir/${mha_app}/${mha_app}.cnf 2.3.5 MHA\u76f8\u5173\u811a\u672c\u5b9a\u4e49 \u9700\u8981\u5728\u4e0b\u5217\u811a\u672c\u4e2d\u65b0\u589evip\u548c\u7f51\u5361\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u811a\u672c\u4e2d\uff0c\u4fee\u6539\u65f6\u4e00\u6837\u7684 # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u5b9e\u73b0\u5728\u7ebf\u5207\u6362master\u8282\u70b9 master_ip_online_change # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u6458\u9664vip master_ip_failover","title":"\u57fa\u4e8eGTID\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#gtid","text":"","title":"\u57fa\u4e8eGTID\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#1gtid","text":"\u5728MySQL\u5b98\u65b9\u5b9a\u4e49\u4e2d\uff0cGTID\u662f G lobal T ransaction ID entifier (GTID)\u7684\u7f29\u5199\uff0c","title":"1\u3001gtid\u6982\u5ff5"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#2gtid","text":"","title":"2\u3001GTID\u5f02\u5e38\u573a\u666f\u6a21\u62df"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#21-gtid","text":"\u53ef\u4ee5\u8bbf\u95ee MHA\u7684github\u4e3b\u9875 \u4e0b\u8f7d\u6e90\u7801\u81ea\u884c\u7f16\u8bd1\u5b89\u88c5\uff0c\u6b64\u5904\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684rpm\u5305,\u9700\u8981\u6ce8\u610f\u5b89\u88c5\u5305\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5339\u914d # \u4e0b\u8f7d MHA Manager\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm # \u4e0b\u8f7d MHA Node\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm","title":"2.1 GTID\u6b63\u5e38\u65f6"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#22-gtid","text":"MHA\u7531 MHA-node\u548cMHA-manger\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMHA-node\u9700\u8981\u90e8\u7f72\u5728\u53c2\u4e0e\u6784\u5efaMHA\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0cMHA-manger\u53ea\u9700\u8981\u5728\u7ba1\u7406\u5b9e\u4f8b\u4e0a\u90e8\u7f72\u5373\u53ef # \u5728\u9700\u8981\u53c2\u4e0eMHA\u90e8\u7f72\u7684MySQL\u5b9e\u4f8b\u4e0a\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u5305\u548cMHA Node yum install perl-DBD-MySQL yum install perl-devel rpm -ivh mha4mysql-node-X.Y-0.noarch. # \u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5\u6240\u9700\u4f9d\u8d56\u548cMHA Manager\uff0cMHA Node \u53ea\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u662f\u591a\u5957MHA\u5171\u7528\u7684 yum install perl-DBD-MySQL yum install perl-devel yum install perl-Config-Tiny yum install perl-Log-Dispatch yum install perl-Parallel-ForkManager rpm -ivh mha4mysql-node-X.Y-0.noarch.rpm rpm -ivh mha4mysql-manager-X.Y-0.noarch.rpm","title":"2.2 GTID\u6b63\u5e38\u65f6"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#23-gtid","text":"\u5b89\u88c5\u5b8cMHA\u7684\u5404\u4e2a\u7ec4\u4ef6\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e:","title":"2.3 \u4fee\u590dgtid\u5f02\u5e38\u95ee\u9898"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#233-gitd","text":"# \u4f9d\u6b21\u5728\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip # \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66\uff08\u53ef\u9009\uff0c\u591a\u5957MHA\u5171\u7528\u7ba1\u7406\u8282\u70b9\u7684\u8bdd\uff0c\u8bc1\u4e66\u5df2\u5b58\u5728\uff09 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u4ece\u7ba1\u7406\u8282\u70b9\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip","title":"2.3.3 \u68c0\u67e5\u4e3b\u3001\u4ece\u5b9e\u4f8bgitd\u503c"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#234-gtid","text":"touch /data/mha_workdir/${mha_app}/${mha_app}.cnf","title":"2.3.4 \u62bd\u53d6\u51fa\u591a\u4f59\u7684gtid"},{"location":"mysql/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#235-mha","text":"\u9700\u8981\u5728\u4e0b\u5217\u811a\u672c\u4e2d\u65b0\u589evip\u548c\u7f51\u5361\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u811a\u672c\u4e2d\uff0c\u4fee\u6539\u65f6\u4e00\u6837\u7684 # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u5b9e\u73b0\u5728\u7ebf\u5207\u6362master\u8282\u70b9 master_ip_online_change # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u6458\u9664vip master_ip_failover","title":"2.3.5 MHA\u76f8\u5173\u811a\u672c\u5b9a\u4e49"},{"location":"redis/index.html","text":"","title":"Index"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html","text":"Redis\u90e8\u7f72\u5b9e\u8df5 Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c\u5355\u673a\u7248\u7684Redis\uff0c\u5728\u8fdb\u884c\u9488\u5bf9\u6027\u90e8\u7f72\uff1a 1.1 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574 # \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo \"echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local 1.2 \u5b89\u88c5\u5305\u4e0b\u8f7d \u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz 1.3 \u7f16\u8bd1\u5b89\u88c5 shell>tar -xzvf redis-5.0.12.tar.gz shell>cd redis-5.0.12 shell>make $$ make install # \u8fd0\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4ee5\u540e\uff0c\u9ed8\u8ba4\u5c06Redis\u76f8\u5173\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u5230/usr/local/bin\u8def\u5f84\u4e0b # \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u786e\u8ba4Redis\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u5426\u4f4d\u4e8e\u73af\u5883\u53d8\u91cf\u5185 shell>which redis-server /usr/local/bin/redis-server shell>redis-server --version Redis server v=5.0.7 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=a257f57b53913ab shell>ll /usr/local/bin/ | grep redis -rwxr-xr-x 1 root root 4366848 Jun 28 20:41 redis-benchmark -rwxr-xr-x 1 root root 8125240 Jun 28 20:41 redis-check-aof -rwxr-xr-x 1 root root 8125240 Jun 28 20:41 redis-check-rdb -rwxr-xr-x 1 root root 4807920 Jun 28 20:41 redis-cli lrwxrwxrwx 1 root root 12 Jun 28 20:41 redis-sentinel -> redis-server -rwxr-xr-x 1 root root 8125240 Jun 28 20:41 redis-server 1.4 \u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 1.5 \u914d\u7f6eRedis\u5f00\u673a\u542f\u52a8\u811a\u672c 1.5.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907 ```bash shell> groupadd -g 6379 redis;useradd -s /sbin/nologin redis -g redis -u 6379 shell> export Redis_base_dir=/apply/redisdata shell> mkdir -p ${Redis_base_dir}/{data,log,run} shell> chown -R redis:redis ${Redis_base_dir} #### 1.5.2 \u914d\u7f6eRedis\u670d\u52a1\u542f\u52a8 ```bash #\u5c06\u6b64\u811a\u672c\u653e\u5230 /usr/lib/systemd/system/\u4e0b vim /usr/lib/systemd/system/redis-server.service [Unit] Description=The redis-server Process Manager After=syslog.target network.target [Service] User=redis Group=redis Type=forking # \u4ee5\u4e0b\u9009\u9879\u53ef\u6839\u636eRedis\u53ef\u6267\u884c\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\u8fdb\u884c\u8fdb\u884c\u4fee\u6539 ExecStart=/usr/local/bin/redis-server /usr/local/redis/config /redis.conf ExecReload=/bin/kill -USR2 $MAINPID ExecStartPost=/bin/sleep 1 ExecStop=/bin/kill -SIGINT $MAINPID PIDFile=/data/redisdata/run/redis.pid [Install] WantedBy=multi-user.target [root@localhost ~]# systemctl enable redis-server Created symlink from /etc/systemd/system/multi-user.target.wants/redis-server.service to /usr/lib/systemd/system/redis-server.service [root@localhost ~]# systemctl status redis-server \u25cf redis-server.service - The redis-server Process Manager Loaded: loaded (/usr/lib/systemd/system/redis-server.service; enabled; vendor preset: disabled) Active: active (running) since Wed 2021-12-15 16:40:10 CST; 1 weeks 0 days ago Main PID: 24562 (redis-server) CGroup: /system.slice/redis-server.service \u2514\u250024562 /usr/local/bin/redis-server *:6379 Dec 15 16:40:09 localhost.localdomain systemd[1]: Starting The redis-server Process Manager... Dec 15 16:40:10 localhost.localdomain systemd[1]: Started The redis-server Process Manager 1.6 Redis\u9ad8\u53ef\u7528\u67b6\u6784\u90e8\u7f72 1.6.1 Redis-sentinel\u90e8\u7f72 1.6.2 Redis-cluster\u90e8\u7f72","title":"Redis\u90e8\u7f72\u5b9e\u8df5"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#redis","text":"Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c\u5355\u673a\u7248\u7684Redis\uff0c\u5728\u8fdb\u884c\u9488\u5bf9\u6027\u90e8\u7f72\uff1a","title":"Redis\u90e8\u7f72\u5b9e\u8df5"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#11","text":"# \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo \"echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local","title":"1.1 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#12","text":"\u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz","title":"1.2 \u5b89\u88c5\u5305\u4e0b\u8f7d"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#13","text":"shell>tar -xzvf redis-5.0.12.tar.gz shell>cd redis-5.0.12 shell>make $$ make install # \u8fd0\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4ee5\u540e\uff0c\u9ed8\u8ba4\u5c06Redis\u76f8\u5173\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u5230/usr/local/bin\u8def\u5f84\u4e0b # \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u786e\u8ba4Redis\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u5426\u4f4d\u4e8e\u73af\u5883\u53d8\u91cf\u5185 shell>which redis-server /usr/local/bin/redis-server shell>redis-server --version Redis server v=5.0.7 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=a257f57b53913ab shell>ll /usr/local/bin/ | grep redis -rwxr-xr-x 1 root root 4366848 Jun 28 20:41 redis-benchmark -rwxr-xr-x 1 root root 8125240 Jun 28 20:41 redis-check-aof -rwxr-xr-x 1 root root 8125240 Jun 28 20:41 redis-check-rdb -rwxr-xr-x 1 root root 4807920 Jun 28 20:41 redis-cli lrwxrwxrwx 1 root root 12 Jun 28 20:41 redis-sentinel -> redis-server -rwxr-xr-x 1 root root 8125240 Jun 28 20:41 redis-server","title":"1.3 \u7f16\u8bd1\u5b89\u88c5"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#14","text":"","title":"1.4 \u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#15-redis","text":"","title":"1.5 \u914d\u7f6eRedis\u5f00\u673a\u542f\u52a8\u811a\u672c"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#151","text":"```bash shell> groupadd -g 6379 redis;useradd -s /sbin/nologin redis -g redis -u 6379 shell> export Redis_base_dir=/apply/redisdata shell> mkdir -p ${Redis_base_dir}/{data,log,run} shell> chown -R redis:redis ${Redis_base_dir} #### 1.5.2 \u914d\u7f6eRedis\u670d\u52a1\u542f\u52a8 ```bash #\u5c06\u6b64\u811a\u672c\u653e\u5230 /usr/lib/systemd/system/\u4e0b vim /usr/lib/systemd/system/redis-server.service [Unit] Description=The redis-server Process Manager After=syslog.target network.target [Service] User=redis Group=redis Type=forking # \u4ee5\u4e0b\u9009\u9879\u53ef\u6839\u636eRedis\u53ef\u6267\u884c\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\u8fdb\u884c\u8fdb\u884c\u4fee\u6539 ExecStart=/usr/local/bin/redis-server /usr/local/redis/config /redis.conf ExecReload=/bin/kill -USR2 $MAINPID ExecStartPost=/bin/sleep 1 ExecStop=/bin/kill -SIGINT $MAINPID PIDFile=/data/redisdata/run/redis.pid [Install] WantedBy=multi-user.target [root@localhost ~]# systemctl enable redis-server Created symlink from /etc/systemd/system/multi-user.target.wants/redis-server.service to /usr/lib/systemd/system/redis-server.service [root@localhost ~]# systemctl status redis-server \u25cf redis-server.service - The redis-server Process Manager Loaded: loaded (/usr/lib/systemd/system/redis-server.service; enabled; vendor preset: disabled) Active: active (running) since Wed 2021-12-15 16:40:10 CST; 1 weeks 0 days ago Main PID: 24562 (redis-server) CGroup: /system.slice/redis-server.service \u2514\u250024562 /usr/local/bin/redis-server *:6379 Dec 15 16:40:09 localhost.localdomain systemd[1]: Starting The redis-server Process Manager... Dec 15 16:40:10 localhost.localdomain systemd[1]: Started The redis-server Process Manager","title":"1.5.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#16-redis","text":"","title":"1.6 Redis\u9ad8\u53ef\u7528\u67b6\u6784\u90e8\u7f72"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#161-redis-sentinel","text":"","title":"1.6.1 Redis-sentinel\u90e8\u7f72"},{"location":"redis/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#162-redis-cluster","text":"","title":"1.6.2 Redis-cluster\u90e8\u7f72"}]}