## 在线切换gtid模式
MySQL在5.6版本之后推出的gtid特性，可以有效简化主从部署、和切换的流程，此博客分享将MySQL主从从传统的(binlog_file,position)
的方式切换到基于gtid的复制模式，在MySQL5.7.6之后，可以在线切换到gtid模式
### 重要概念
在正式切换前，以下概念非常重要，需要提前熟悉：

### 整体的切换流程如下：

1、在每个参与切换的MySQL实例上执行下列语句,实例无先后,等到所有实例的错误日志没有warnning告警时，进入下一步:
```bash 
mysql> SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY = WARN; 
```

2、在每个参与切换的MySQL实例上执行下列语句，先主后从:
```bash
mysql> SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY = ON;
```

3、在每个参与切换的MySQL实例上执行下列语句，实例无先后:
```bash
mysql> SET @@GLOBAL.GTID_MODE = OFF_PERMISSIVE;
```

4、在每个参与切换的MySQL实例上执行下列语句，实例无先后:
```bash
mysql> SET @@GLOBAL.GTID_MODE = ON_PERMISSIVE;
```

5、在每个参与切换的MySQL实例上执行下列语句，运行下列语句，查看对应的值是否为0：
```bash
mysql> show global status like 'ONGOING_ANONYMOUS_TRANSACTION_COUNT';
```
6、在主库上执行下列语句，转储binlog
```bash
mysql> flsuh logs;
```

7、在每个参与切换的MySQL实例上执行下列语句，执行下列语句，切换到gtid模式, 先主后从
```bash
mysql> SET @@GLOBAL.GTID_MODE = ON; 
```
9、在每个实例上修改/etc/my.cnf,新增|修改下列配置项
```bash
gtid_mode=ON 
enforce_gtid_consistency=ON
transaction_write_set_extraction=XXHASH64
```
10、在slave上执行下列语句，使用MASTER_AUTO_POSITION=1 替代【binlog_file,position】

```bash
mysql> stop slave;
mysql> CHANGE MASTER TO MASTER_HOST='192.168.32.102' ,MASTER_USER='repl' ,MASTER_PASSWORD='Repl_Pass_321',MASTER_AUTO_POSITION=1 for channel 'master_3'; 
mysql> start slave;				
```