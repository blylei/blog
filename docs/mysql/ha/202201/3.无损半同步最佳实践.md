# MySQL无损半同步最佳实践
MySQL从库可能会因为很多原因导致主从不一致,我们可以将从库设置为read_only或者super_read_only,并且使用RBR来避免在从库执行更新导致的主从不一致，但这
些选项也无法完全避免主从不一致。当主从不一致无法通过常规方法修复时，我们只能通过重建Slave的方式来修复主从不一致的问题。

为了重建Slave，需要有两方面的信息。首先，需要有一个处于一致性的备份集；其次，为了重建与原主的主从关系，还需要binlog的位点信息或者gtid。
为了满足以上两点要求，可以采用下列方法来获得一致性的备份集和主从位点信息:

## 1、工作原理

## 2、无损半同步部署
在部署无损半同步之前，需要准备好MySQL的主从复制环境。以下介绍正是基于已经存在的异步复制环境进行改造
### 2.1 主库安装插件

### 2.2 从库安装插件

### 2.3 主库启动半同步插件并修改配置文件

### 2.4 从库启动半同步插件并修改配置文件

### 2.5 确认半同步复制是否正常工作

## 3、无损半同步复制陷阱
在配置无损半同步复制时，有几种场景容易导致事务丢失，需要重点关注

### 3.1、半同步回退到异步，导致的事故

### 3.2、半同步回退到异步，导致事务丢失

### 3.3、重用故障后的master

## 4、failover的陷阱