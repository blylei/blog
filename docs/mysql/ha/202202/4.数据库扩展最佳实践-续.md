## 数据库扩展最佳实践-续

[此博客翻译自Severalnines，单击查看原文](https://severalnines.com/database-blog/best-practices-scaling-databases-part-two)

在执行switchover命令的时候，MHA按以下流程来切换主库到新的数据库实例

### 1、横向扩展面临的挑战

- 连接到mha配置文件里面指定的所有机器上，识别出主节点的机器信息。在配置MHA时，无需手动指定Master实例的机器信息。MHA在
检查主从配置的同时，将read_only=On的实例标识为Master
  
- 在主库执行```FLUSH TABLES```刷新

- 检查是否有monitoring或者failover的进程存在

- 检查以下条件是否满足：
  
  - 所有Slave的IO线程正常运行
    
  - 所有Slave的SQL线程正常运行
  
  - 所有Slave的**Seconds_Behind_Master**状态值小于2秒
  
  - 在当前主节点的```show processlist```输出的列表里面，没有查询执行时间超过2秒

### 2、如何横向扩展数据库

到目前为止，我们已经知道了横向扩展将会面临的挑战，我们可以采用哪些方式去实现呢？如何横向扩展数据库？

#### 2.1、添加从库


#### 2.2、数据分片
- 可以通过```--new_master_host```命令行参数显式指定新主；如果没有显式指定的话，MHA根据配置文件自动选出新主
