## 数据库扩展最佳实践

[此博客整理自Severalnines，单击查看原文](https://severalnines.com/database-blog/best-practices-scaling-databases-part-1)

在执行switchover命令的时候，MHA按以下流程来切换主库到新的数据库实例

### 1、为什么需要扩展

### 1.1、硬件资源消耗增长
连接到mha配置文件里面指定的所有机器上，识别出主节点的机器信息。在配置MHA时，无需手动指定Master实例的机器信息。MHA在

### 1.2、工作负载突然增长

### 1.3、有计划的运维

### 2、扩展方式

目前主要有两种扩展方式，分别为**垂直扩展**和**水平扩展**。每一种扩展方式都有器优势和劣势，适用于不同的场景，接下来将分别
介绍。

#### 2.1、垂直扩展
- 可以通过```--new_master_host```命令行参数显式指定新主；如果没有显式指定的话，MHA根据配置文件自动选出新主

##### 2.1.1、垂直扩展的优势
- 原主和新主必须确保binlog过滤规则一致，(binlog-do-db and binlog-ignore-db)

##### 2.1.1、垂直扩展的劣势

#### 2.2、水平扩展
- 可以通过```--new_master_host```命令行参数显式指定新主；如果没有显式指定的话，MHA根据配置文件自动选出新主

##### 2.2.1、水平扩展的优势
- 原主和新主必须确保binlog过滤规则一致，(binlog-do-db and binlog-ignore-db)

##### 2.2.1、水平扩展的劣势

### 3、扩展的前提条件

- 如果在MHA配置文件里面定义```master_ip_online_change_script```,MHA调用指定的脚本：可以在脚本里面移除可读写账号，或者```set global read_only=on```

- 在原主执行```FLUSH TABLES WITH READ LOCK```锁定整个实例来阻止数据写入。也可以设置```--skip_lock_all_tables```参数跳过此步骤
